{% extends "layout.html" %}

{% block title %}
    Search User
{% endblock %}

{% block main %}


<div class="col-md-12 mb-3 mt-5 no-gutters profile-alignment">
    <div class="col-md-2">
        <img src="{{ user_image }}" onerror="this.src = 'static/default.png';" alt="profile picture" class="img-fluid float-left img-thumbnail pull-left mr-3" width="500px" height="500px" id="profile">
        <!--https://via.placeholder.com/500-->
    </div>
    <div class="col-md-3 pl-5">
        <table class="col-md-12 table-striped">
            <tr class="col-md-3">
                <td>Username: </td>
                <td class="userinfo-alignment" id="username"></td>
            </tr>
            <tr class="col-md-3">
                <td>Age: </td>
                <td class="userinfo-alignment" id="age"></td>
            </tr>
            <tr class="col-md-3">
                <td>Height: </td>
                <td class="userinfo-alignment" id="height"></td>
            </tr>
            <tr class="col-md-3">
                <td>Bodyweight: </td>
                <td class="userinfo-alignment" id="bodyweight"></td>
            </tr>
            <tr class="col-md-3">
                <td>Redpoint: </td>
                <td class="userinfo-alignment" id="redpoint"></td>
            </tr>
            <tr class="col-md-3">
                <td>Onsight: </td>
                <td class="userinfo-alignment" id="onsight"></td>
            </tr>
        </table>
    </div><!--
    <div class="col-md-4 pl-5">
        <canvas id="chart" width="400" height="300"></canvas>
        <div class="pl-5">
            <input type="checkbox" id="dataCheckbox" name="dataCheckbox"
                   checked>
            <label for="dataCheckbox">Show only topped Routes</label>
          </div>
    </div>-->
</div>
<div class="col-md-12 mb-3 no-gutters profile-alignment">
    <p class="lead" id="about_me"></p>
</div>

<div class="form-group form-alignment">
    <input class="form-control" autocomplete="off" autofocus placeholder="Search User" type="text" class="mb-3">
</div>

<h1 class="display-5">Users Found</h1>

<div class="table-responsive-md">
    <table class="table table-striped table-hover table-sm col-md-6">
        <thead class="thead-light">
            <tr>
                <th class="col-md-3">Username</th>
                <th class="col-md-1"></th>
            </tr>
        </thead>
        <tbody id="tbodySearchTable"></tbody>
    </table>
</div>



<script crossorigin="anonymous" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    let input = document.querySelector("input");


    input.addEventListener('keyup', function() {
        $.get("/search?q=" + input.value, function(result) {
            let htmltable = "";
            for (let i = 0; i < result.length; i++) {
                let username = result[i].username;
                htmltable += "<tr><td>" + username + "</td><td><button class='btn btn-primary' type='submit' value=" + username + " onclick='processSearchUserInput(this.value)'>View Details</button></td></tr>"
            }
            document.getElementById("tbodySearchTable").innerHTML = htmltable;
        });
    });

    function processSearchUserInput(username) {
            $.ajax({
                    type: "POST",
                    url: "{{url_for('processSearchUserInput')}}",
                    data: {
                        name: username,
                    }
                })
            .done(function(data) {
                data = data[0];
                console.table(data[0]);
                for (const [key, value] of Object.entries(data)) {
                    console.log(key, value);
                    document.getElementById(key).innerHTML = value;
                }
                document.getElementById("age").innerHTML = document.getElementById("age").innerHTML + " years";
                document.getElementById("height").innerHTML = document.getElementById("height").innerHTML + " cm";
                document.getElementById("bodyweight").innerHTML = document.getElementById("bodyweight").innerHTML + " kg";
            });
        }


</script>

{% endblock %}